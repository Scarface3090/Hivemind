# Hivemind - Social Guessing Game for Reddit

A social guessing game built on Reddit's Devvit platform where players try to "read the host's mind" by guessing a secret target value on a dynamic spectrum. Combines community discussion with interactive gameplay.

## üéÆ Game Overview

**Hivemind** is an asynchronous social guessing game where:
- **Hosts** create games with clues and secret targets on dynamic spectra (e.g., "Coffee ‚Üî Tea")
- **Players** click game posts and immediately start guessing using an interactive slider ‚ú® **NEW: Direct Game Entry**
- **Scoring** combines guessing accuracy with social influence (comment upvotes)
- **Results** show detailed analytics, consensus labels, and community accolades

### üöÄ Direct Game Entry - Zero-Friction Gameplay ‚úÖ FULLY ACTIVE
Users can click on any Hivemind game post in their Reddit feed and immediately see the appropriate game interface - no navigation required! The system intelligently detects the game context and automatically routes to the guessing interface for active games or results view for completed games.

**‚ú® NEW: Enhanced Debug Tools** - Developers can now enable visual debugging with `?debug=context` URL parameter or localStorage flag to monitor context detection in real-time.

## üèóÔ∏è Architecture

Built as a monorepo with three main components:

### Frontend (`/src/client`)
- **React 18** - UI framework with TypeScript
- **Phaser 3.88** - Interactive game elements (sliders, histograms)
- **React Router** - Client-side navigation
- **Tanstack Query** - Server state management
- **Tailwind CSS** - Utility-first styling

### Backend (`/src/server`)
- **Express 5** - Serverless API on Devvit runtime
- **Redis** - Data persistence and caching
- **Zod** - Runtime validation and schemas
- **Background Jobs** - Automated game lifecycle management

### Shared (`/src/shared`)
- **TypeScript Types** - Game state, scoring, and API contracts
- **Validation Schemas** - Zod schemas for type safety
- **Utilities** - Common functions and constants

## üöÄ Key Features Implemented

### Direct Game Entry System ‚úÖ FULLY IMPLEMENTED & ACTIVE
- **Context Detection API** - Server endpoint `/api/context` detects when users access specific game posts ‚úÖ ACTIVE
- **Post Data Integration** - Leverages Devvit's `context.postData` to identify game context ‚úÖ ACTIVE
- **Client-Side Context Hook** - `useGameContext` hook with React Query integration and 5-minute caching ‚úÖ ACTIVE
- **GameContextLayout Component** - Intelligent routing component integrated at router root level ‚úÖ ACTIVE
- **Automatic Game Routing** - Routes active games ‚Üí guessing interface, ended games ‚Üí results view ‚úÖ ACTIVE
- **Intelligent Fallback** - Gracefully handles invalid contexts with fallback to home screen ‚úÖ ACTIVE
- **Graceful Error Handling** - Robust error handling prevents broken states with comprehensive retry logic ‚úÖ ACTIVE
- **Performance Optimized** - Single API call for context detection with intelligent caching and retry logic ‚úÖ ACTIVE
- **Smart Game State Routing** - Validates game state and routes to appropriate view based on game phase ‚úÖ ACTIVE
- **Context Validation** - Validates game IDs, handles invalid/expired contexts, and prevents navigation loops ‚úÖ ACTIVE
- **Debug Tools Integration** - Visual debugging overlay with real-time context monitoring ‚úÖ NEW

### Dynamic Content System ‚ú® NEW
- **Embedded CSV Content Management** - 150 curated spectra embedded directly in the application code
- **Context Selection Interface** - Hosts can choose from 12 categories: Movies, Food, Gaming, Technology, Social Media, Life Skills, Relationships, Lifestyle, Entertainment, Internet Culture
- **Difficulty Filtering** - Easy (65), Medium (52), Hard (30) difficulty levels with live availability counts
- **Smart Caching** - Redis-based content indexing with server startup initialization
- **Multi-Tier Fallbacks** - Embedded CSV ‚Üí Google Sheets ‚Üí Hardcoded spectra for maximum reliability
- **Real-time Content Stats** - Live counts of available spectra per context and difficulty
- **Robust Server Initialization** - Content validation and statistics logging on startup
- **Serverless-Optimized** - No file system dependencies, content embedded in application bundle
- **Error Boundary Protection** - ContextSelectionErrorBoundary prevents content loading errors from breaking the host flow
- **Enhanced API Logging** - Comprehensive request/response logging for context API endpoints with detailed error tracking

### Game Lifecycle
- **Draft System** - Hosts receive random spectra with secret targets
- **Timed Rounds** - Configurable durations (1-24 hours)
- **Live Median** - Real-time community consensus updates
- **Automated Transitions** - Background jobs handle phase changes
- **Backward Compatibility** - Graceful handling of legacy games with missing or invalid spectrum data

### Interactive Gameplay
- **Phaser Slider** - Touch-optimized spectrum selection
- **Justification System** - Optional reasoning that affects scoring
- **Reddit Comment Integration** - Player guesses and justifications automatically posted as Reddit comments ‚ú® **NEW**
- **Median Visualization** - Live community consensus indicator
- **Mobile-First Design** - Optimized for vertical, touch screens

### Advanced Scoring
- **Accuracy Score** - Distance from secret target
- **Social Score** - Based on comment upvotes
- **Consensus Analysis** - Community agreement metrics
- **Accolades System** - "Psychic", "Top Comment", "Unpopular Opinion"

### Results & Analytics
- **Interactive Histograms** - Phaser-powered distribution charts
- **Consensus Labels** - "Perfect Hivemind", "Battle Royale", etc.
- **Player Rankings** - Leaderboards with detailed breakdowns
- **Host Analytics** - Game performance metrics

## üõ†Ô∏è Technology Stack

- **Platform**: Reddit Devvit (Node.js 22 serverless runtime)
- **Frontend**: React 18 + Phaser 3.88 + TypeScript
- **Backend**: Express 5 + Redis + Zod validation
- **Build**: Vite + TypeScript project references
- **Quality**: ESLint + Prettier + Vitest testing

## üîå New API Endpoints ‚ú®

### Social Integration System ‚ú® **NEW**
Enhanced guess submission with automatic Reddit comment integration and robust error handling:

```bash
# Guess Submission with Reddit Integration
POST /api/games/:gameId/guesses     # Submit guess with automatic Reddit comment posting

# Guess Request (enhanced with Reddit integration)
{
  "value": 75,                      # Player's guess value (0-100)
  "justification": "Optional reasoning text"  # Posted as Reddit comment if provided
}

# Guess Response (enhanced with comment tracking)
{
  "guess": {
    "guessId": "guess_123",
    "value": 75,
    "justification": "Optional reasoning",
    "redditCommentId": "t1_abc123"  # NEW: Reddit comment ID for social scoring
  },
  "median": {
    "median": 68.5,
    "sampleSize": 12
  }
}

# Enhanced Error Handling Features:
# - Type-safe error message extraction for both Error objects and string errors
# - Dual-mode comment posting: USER mode with APP mode fallback
# - Comprehensive error logging with detailed context information
# - Guess persistence guaranteed even if comment posting fails
# - Detailed debug logging for troubleshooting comment integration issues
```

### Dynamic Content System
Enhanced content management with context and difficulty filtering:

```bash
# Context Management
GET /api/contexts                    # Get available contexts with counts
POST /api/games/draft               # Enhanced draft with context/difficulty filters

# Enhanced Draft Request (backward compatible)
{
  "context": "Movies",              # Optional: filter by context
  "difficulty": "MEDIUM"            # Optional: filter by difficulty
}

# Context Response
{
  "contexts": [
    {
      "context": "Movies",
      "totalCount": 25,
      "difficultyBreakdown": {
        "EASY": 8,
        "MEDIUM": 12,
        "HARD": 5
      }
    }
  ]
}
```

### Direct Game Entry System ‚úÖ FULLY ACTIVE
Seamless game access from Reddit posts with intelligent routing:

```bash
# Game Context Detection
GET /api/context                     # Detect game context from post data

# Context Response
{
  "gameId": "game_123",             # Game ID if accessed from game post
  "isDirectGameAccess": true,       # Whether user accessed via game post
  "postData": {                     # Full post data from Devvit context
    "gameId": "game_123",
    "host": "username",
    "startTime": "2024-10-24T10:00:00Z",
    "endTime": "2024-10-24T22:00:00Z",
    "spectrum": {
      "leftLabel": "Coffee",
      "rightLabel": "Tea"
    }
  },
  "debugInfo": {                    # Enhanced debugging information
    "hasPostData": true,
    "postDataKeys": ["gameId", "host", "startTime", "endTime", "spectrum"],
    "postId": "post_abc123",
    "contextKeys": ["postId", "userId", "subredditName", "postData"]
  }
}
```

**Implementation Status:**
- **useGameContext Hook** - React hook for context detection with React Query caching and intelligent retry logic ‚úÖ ACTIVE
- **GameContextLayout Component** - Intelligent routing component integrated at router root level ‚úÖ ACTIVE
- **GameContextErrorBoundary** - Simplified pass-through component with graceful error handling ‚úÖ ACTIVE
- **Context Detection API** - Server endpoint `/api/context` fully functional and detecting game context ‚úÖ ACTIVE
- **Automatic State Detection** - Routes to guessing view for active games, results view for ended games ‚úÖ ACTIVE
- **Graceful Degradation** - Falls back to normal home screen behavior on any errors ‚úÖ ACTIVE
- **Performance Optimized** - 5-minute caching, single API call, minimal loading states ‚úÖ ACTIVE
- **Debug Tools** - GameContextDebugger component with real-time monitoring and interactive controls ‚úÖ ACTIVE

### API Monitoring & Debugging ‚ú® NEW
- **Request/Response Logging** - All context API calls are logged with detailed request information
- **Error Tracking** - Comprehensive error logging with stack traces and context information
- **Performance Monitoring** - Response times and success rates tracked for context endpoints
- **Debug Information** - Detailed logging shows context counts, filtering results, and cache performance

### Developer Debug Tools ‚úÖ FULLY ACTIVE
- **GameContextDebugger Component** - Visual debugging overlay integrated into main App component
- **useGameContextDebug Hook** - Enhanced debugging version of useGameContext with comprehensive logging
- **Real-time Debug Panel** - Shows current path, game ID, direct access status, loading state, and errors
- **Debug Mode Activation** - Enable via URL parameter `?debug=context` or localStorage flag for persistent debugging
- **Debug Log History** - Maintains last 20 debug entries with timestamps for troubleshooting
- **Interactive Debug Controls** - Enable/disable context queries and debug mode from the UI
- **Enhanced Server-Side Debugging** - Comprehensive logging of Devvit context properties and postData structure
- **Multi-Strategy Context Detection** - API attempts multiple methods to extract gameId from various context sources
- **Detailed Debug Responses** - API includes debugInfo with context keys, postData analysis, and error details
- **Router Independence** - Debug component works without React Router dependencies for maximum compatibility
- **Visual Debugging Overlay** - Collapsible debug panel that doesn't interfere with normal app usage

## üìã Development Commands

```bash
# Development (runs client, server, and devvit in parallel)
npm run dev

# Build everything
npm run build

# Individual builds
npm run build:client  # React/Phaser frontend
npm run build:server  # Express backend

# Quality checks
npm run check         # Type check + lint + format
npm run type-check    # TypeScript compilation
npm run lint:fix      # Fix linting issues
npm run prettier      # Format code

# Testing
npm run test          # Run Vitest test suite

# Debug Tools ‚ú® ACTIVE
# Enable context debugging via URL parameter: ?debug=context
# Or via browser console: localStorage.setItem('gameContextDebug', 'true')
# Visual debugging overlay shows real-time context detection status

# Authentication & Deployment
npm run login         # Login to Reddit/Devvit CLI
npm run deploy        # Build and upload to Devvit
npm run launch        # Deploy and publish for review
```

## üéØ Getting Started

> Requires Node.js 22+

1. **Clone and Install**
   ```bash
   git clone <repository>
   cd hivemind
   npm install
   ```

2. **Development Setup**
   ```bash
   npm run login    # Authenticate with Reddit
   npm run dev      # Start development servers
   ```

3. **Content Configuration** ‚ú® ENHANCED
   - Primary: 150 spectra embedded directly in application code for maximum reliability
   - 12 Content Categories: Movies, Food, Gaming, Technology, Social Media, Life Skills, Relationships, Lifestyle, Entertainment, Internet Culture
   - Balanced Difficulty: 65 Easy, 52 Medium, 30 Hard spectra
   - Fallback: Optional Google Sheets integration via environment variables
   - Final fallback: Hardcoded spectra ensure system reliability
   - Content loads automatically during server startup with comprehensive validation

## üìÅ Project Structure

```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ client/          # React + Phaser frontend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views/       # Main screens (‚ú® ENHANCED: HostView with content selection)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Reusable UI components (‚ú® NEW: ContextSelector, DifficultySelector, ContextSelectionErrorBoundary, GameContextRouter, GameContextErrorBoundary, GameContextDebugger)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # Custom React hooks (‚ú® NEW: useGameContext, useGameContextDebug)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/        # Phaser scenes and systems
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/         # HTTP client wrappers (‚ú® NEW: Context APIs)
‚îÇ   ‚îú‚îÄ‚îÄ server/          # Express serverless backend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/        # Business logic and services
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/  # API endpoints (‚ú® NEW: /api/contexts, /api/context)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/# Game logic, scoring, content (‚ú® ENHANCED: Dynamic content system)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis/   # Data access layer (‚ú® NEW: Context indexing)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/  # Express middleware
‚îÇ   ‚îî‚îÄ‚îÄ shared/          # Common types and utilities
‚îÇ       ‚îú‚îÄ‚îÄ types/       # TypeScript interfaces
‚îÇ       ‚îú‚îÄ‚îÄ schemas.ts   # Zod validation schemas
‚îÇ       ‚îî‚îÄ‚îÄ constants.ts # Application constants
‚îú‚îÄ‚îÄ docs/                # Project documentation
‚îú‚îÄ‚îÄ tests/               # Test files
‚îî‚îÄ‚îÄ tools/               # Build configuration
```

## üéÆ Game Flow

1. **Host Flow**: Choose context & difficulty ‚Üí Receive filtered spectrum + secret target ‚Üí Add clue ‚Üí Publish
2. **Player Flow**: Click game post ‚Üí Automatically routed to guessing interface ‚Üí See median ‚Üí Submit guess + justification ‚Üí **Automatic Reddit comment posting** ‚ú® **NEW**
3. **Results**: View accuracy scores ‚Üí Social influence metrics ‚Üí Community consensus ‚Üí Accolades

### Enhanced Host Experience ‚ú® NEW
- **Step-by-Step Content Selection**: Visual context cards ‚Üí Difficulty options ‚Üí Clue creation
- **Content Preview**: See available spectrum counts before selection
- **Smart Filtering**: Get spectra tailored to chosen context and difficulty
- **Breadcrumb Navigation**: Easy back-and-forth between selection steps
- **Graceful Error Handling**: Context selection errors are contained with retry options, preventing host flow interruption

## üîß Configuration

- **Devvit Config**: `devvit.json` - Platform settings, scheduler, menu items, Reddit permissions ‚ú® **ENHANCED**
- **Reddit Permissions**: `SUBMIT_COMMENT` permission enabled for automatic comment posting
- **TypeScript**: Project references for monorepo structure
- **Build**: Vite configs for client/server with different targets
- **Content Management**: Multi-tier content system with flexible configuration

## üèóÔ∏è Content Management Architecture Decision

### Current Implementation: Embedded CSV Data (Prototype)

For the initial prototype launch, we've implemented **embedded CSV content** directly in the server code:

**Why Embedded Data:**
- ‚úÖ **Serverless Compatibility**: No file system dependencies in Devvit's serverless environment
- ‚úÖ **Zero External Dependencies**: Content always available without network calls
- ‚úÖ **Deployment Simplicity**: Content bundled with application code
- ‚úÖ **Guaranteed Availability**: No risk of external service failures
- ‚úÖ **Fast Startup**: Instant content loading without I/O operations

**Current Implementation:**
- 150 curated spectra embedded as string constant in `src/server/core/services/content.service.ts`
- Multi-tier fallback system: Embedded CSV ‚Üí Google Sheets ‚Üí Hardcoded spectra
- Server startup validation ensures content integrity
- Content updates require code deployment

### Post-Launch Migration: Redis-Based Dynamic Content

**Planned Enhancement for v2.0:**
```typescript
// Future Redis-based implementation
await redis.set('spectra_csv_data', csvString);
const csvData = await redis.get('spectra_csv_data');
const spectraData = parseCSV(csvData);
```

**Benefits of Redis Approach:**
- üöÄ **Dynamic Updates**: Content updates without redeployment
- üîß **Admin Interface**: Moderator tools for content management
- üìä **Version Control**: Content history and rollback capabilities
- üîÑ **Hot Reload**: Instant content updates across all servers
- üìà **Scalability**: Centralized content management

**Migration Timeline:**
- **Phase 1** (Current): Embedded CSV for prototype stability
- **Phase 2** (Post-launch): Redis-based dynamic content system
- **Phase 3** (Future): Full content management dashboard

This architectural decision prioritizes **reliability and simplicity** for the initial launch while maintaining a clear path to **dynamic content management** for future iterations.

### Server Startup Process ‚ú® NEW

The server now includes a comprehensive initialization process that ensures content is loaded and validated before accepting requests:

#### Startup Sequence
1. **CSV Content Loading** - Reads and parses `spectra.csv` from assets folder
2. **Content Validation** - Validates each spectrum entry for required fields and data integrity
3. **Cache Population** - Stores validated content in Redis with context indexing
4. **Statistics Generation** - Logs detailed breakdown of available content
5. **Fallback Handling** - Gracefully handles errors with multi-tier fallback system

#### Startup Logging Example
```
=== Server Startup Initialization ===
Loading content from embedded CSV data...
CSV headers found: ID, Context, Left_Label, Right_Label, Difficulty
Processing 150 data rows...
CSV parsing complete: 150 valid, 0 invalid rows
‚úì Successfully loaded 150 spectra from embedded CSV data
Initializing spectrum cache...
‚úì Spectrum cache initialized with 150 entries
Content Statistics:
  Total Spectra: 150
  Unique Contexts: 12
    Movies: 15 spectra
    Food: 15 spectra
    Gaming: 15 spectra
    Technology: 15 spectra
    Social Media: 15 spectra
    Life Skills: 15 spectra
    Relationships: 15 spectra
    Lifestyle: 15 spectra
    Entertainment: 15 spectra
    Internet Culture: 15 spectra
  Difficulty Distribution:
    EASY: 65 spectra
    MEDIUM: 52 spectra
    HARD: 30 spectra
‚úì Server initialization completed successfully
```

#### API Request Logging Example ‚ú® NEW
```
[API] GET /api/contexts - Loading contexts with counts
Retrieved context summary from cache for 12 contexts
  Movies: 15 total (Easy: 8, Medium: 5, Hard: 2)
  Food: 15 total (Easy: 9, Medium: 4, Hard: 2)
  Gaming: 15 total (Easy: 7, Medium: 6, Hard: 2)
[API] GET /api/contexts - Found 12 contexts: Movies (15), Food (15), Gaming (15)...
```

#### Debug Mode Usage ‚ú® ENHANCED
```bash
# Enable debug mode via URL parameter
https://your-app.com/?debug=context

# Or enable via browser console
localStorage.setItem('gameContextDebug', 'true');
window.location.reload();

# Debug panel shows:
# - Current navigation path (router-independent tracking)
# - Game context detection results with enhanced server-side logging
# - API call status and comprehensive error details
# - Real-time debug log with timestamps and context analysis
# - Interactive controls for enabling/disabling context queries
# - Persistent debug mode across page reloads
# - Server-side context debugging with Devvit context property inspection
# - Multi-level gameId extraction attempts and fallback strategies
# - Detailed debugInfo responses with context keys and postData structure
```

#### Error Handling ‚ú® ENHANCED
- **CSV Loading Failures**: Automatically falls back to Google Sheets (if configured) or hardcoded spectra
- **Validation Errors**: Logs detailed error information while continuing with valid content
- **Cache Failures**: Server starts with in-memory fallback content to ensure availability
- **Graceful Degradation**: Server always starts successfully, even with minimal fallback content
- **Legacy Game Recovery**: Games with missing or invalid spectrum data automatically use fallback spectra to prevent crashes
- **Optimized Validation**: Streamlined validation pipeline trusts pre-validated cache data, eliminating redundant checks
- **Performance-First Fallbacks**: Simplified error recovery focuses on speed and reliability over complex validation

### Content System Configuration ‚ú® NEW
- **Primary Source**: Embedded CSV data directly in `content.service.ts` - 150 curated spectra across 12 contexts
- **Content Categories**: Movies, Food, Gaming, Technology, Social Media, Life Skills, Relationships, Lifestyle, Entertainment, Internet Culture
- **Difficulty Distribution**: 65 Easy, 52 Medium, 30 Hard spectra for balanced gameplay
- **Google Sheets Fallback**: Optional integration via environment variables:
  - `GOOGLE_SHEETS_API_KEY` - API key for Sheets access
  - `GOOGLE_SHEETS_SPREADSHEET_ID` - Spreadsheet identifier
  - `GOOGLE_SHEETS_RANGE` - Data range (e.g., "Sheet1!A:D")
  - `GOOGLE_SHEETS_CACHE_TTL_MINUTES` - Cache refresh interval (default: 15)
- **Hardcoded Fallback**: Built-in spectra ensure system always functions
- **Server Startup Loading**: Content initialized during server startup with comprehensive validation
- **Serverless Compatibility**: No file system dependencies, optimized for Devvit's serverless environment

### Performance Optimizations ‚ú® NEW
- **Proactive Server Initialization**: Content loading and validation during server startup
- **Smart Caching**: Redis-based content indexing with context and difficulty filters
- **Efficient Filtering**: Pre-computed indexes for instant context/difficulty lookups
- **Graceful Degradation**: Multi-tier fallback system ensures reliability
- **Startup Validation**: Comprehensive content statistics and error reporting

### Monitoring & Debugging ‚ú® NEW
- **API Request Logging**: All context API requests logged with detailed timing and response information
- **Error Tracking**: Comprehensive error logging with stack traces and contextual information
- **Performance Metrics**: Response times and success rates tracked for all content endpoints
- **Debug Information**: Detailed logging shows context filtering results, cache hits/misses, and content statistics
- **Operational Visibility**: Clear logging for troubleshooting content loading and API performance issues

## üìä Success Metrics

Primary metric: **Completed Games** (hosted ‚Üí guessed ‚Üí revealed)

Secondary metrics:
- Player engagement and retention
- Comment interaction rates
- Game completion rates
- Community consensus quality

## ‚úÖ Current Status: Direct Game Entry - FULLY ACTIVE

### Complete Implementation - All Systems Operational

The direct game entry system is **fully implemented and operational**. Users clicking on Hivemind game posts in their Reddit feed are automatically routed to the appropriate game interface with zero friction.

**‚úÖ ACTIVE COMPONENTS:**
- **Context Detection API** (`/api/context`) - Fully functional, detects game context from Devvit post data
- **useGameContext Hook** - React hook with React Query caching and intelligent retry logic
- **GameContextLayout Component** - Intelligent routing component integrated at router root level
- **Automatic Game Routing** - Active games ‚Üí guessing interface, ended games ‚Üí results view
- **Server Integration** - Context routes integrated with comprehensive error handling
- **Error Boundaries** - Graceful error handling prevents app crashes
- **Debug Tools** - Visual debugging overlay with real-time context monitoring

**üéØ USER EXPERIENCE:**
- **Zero-Friction Entry**: Click game post ‚Üí immediately see guessing interface (active games) or results (ended games)
- **Intelligent Routing**: System automatically detects game state and routes to appropriate view
- **Graceful Fallbacks**: Invalid or expired games gracefully redirect to home screen
- **Performance Optimized**: Single API call with 5-minute caching for optimal performance
- **Debug Support**: Developers can enable visual debugging with `?debug=context` URL parameter

**üîß TECHNICAL IMPLEMENTATION:**
- Router structure: `GameContextLayout` ‚Üí `AppLayout` ‚Üí individual views
- Context detection on initial app load with smart caching
- Comprehensive error handling with fallback to normal navigation
- Game state validation ensures users see appropriate interface

## üÜï Recent Updates

### Latest Social Integration Updates ‚ú® NEW
- ‚úÖ **Automatic Reddit Comment Integration**: Player guesses with justifications are now automatically posted as Reddit comments under the game post
- ‚úÖ **Enhanced Guess Submission**: Guess service now handles Reddit comment posting with proper error handling and fallback behavior
- ‚úÖ **Comment ID Tracking**: Each guess now tracks its associated Reddit comment ID for future social scoring integration
- ‚úÖ **Robust Comment Posting**: Comment posting failures don't prevent guess submission - the guess is always persisted first
- ‚úÖ **Enhanced Error Handling**: Improved error message extraction with type-safe error handling for both USER and APP comment posting modes
- ‚úÖ **Debug Logging**: Comprehensive logging for Reddit comment integration with detailed error tracking and fallback behavior
- ‚úÖ **User Context Integration**: Proper user authentication and context handling for Reddit API calls
- ‚úÖ **Dual-Mode Comment Posting**: Attempts USER mode first, gracefully falls back to APP mode with detailed error logging

### Latest Performance & Reliability Updates ‚ú® NEW
- ‚úÖ **Optimized Game Lifecycle**: Removed redundant spectrum validation in game metadata hydration for improved performance
- ‚úÖ **Streamlined Error Recovery**: Simplified fallback logic trusts pre-validated cache data, reducing processing overhead
- ‚úÖ **Enhanced Code Quality**: Improved code formatting and structure for better maintainability
- ‚úÖ **Performance-First Architecture**: Eliminated duplicate validation steps while maintaining robust error handling
- ‚úÖ **Trusted Cache System**: Game lifecycle service now relies on pre-validated spectrum cache for optimal performance

### Latest Infrastructure & Integration Updates ‚ú® ENHANCED
- ‚úÖ **Legacy Game Compatibility**: Enhanced game lifecycle service with automatic fallback handling for games with missing or invalid spectrum data
- ‚úÖ **Robust Error Recovery**: Games with outdated spectrum references now automatically use fallback spectra instead of crashing
- ‚úÖ **Streamlined Validation**: Removed redundant spectrum validation since cache already contains validated data, improving performance
- ‚úÖ **Optimized Error Handling**: Simplified validation pipeline with trusted cache data and comprehensive fallback logging
- ‚úÖ **Backward Compatibility Logging**: Comprehensive logging for legacy game recovery with detailed error tracking and fallback usage
- ‚úÖ **Performance Optimization**: Eliminated duplicate validation steps by trusting pre-validated cache data

### Previous Infrastructure & Integration Updates
- ‚úÖ **GameContextLayout Integration**: Successfully integrated GameContextLayout at router root level for optimal context detection
- ‚úÖ **Router Structure Optimization**: Fixed router hierarchy with GameContextLayout ‚Üí AppLayout ‚Üí views for proper context flow
- ‚úÖ **Component Export Fixes**: Resolved ActiveGameCard export issues and eliminated duplicate imports
- ‚úÖ **GameContextDebugger Integration**: Integrated visual debugging overlay into main App component with GameContextDebugger wrapper
- ‚úÖ **Hook Dependencies Optimization**: Fixed React useEffect dependencies to prevent unnecessary re-renders and ensure proper state management
- ‚úÖ **Simplified Error Handling**: Streamlined error handling with graceful fallbacks throughout the context detection pipeline
- ‚úÖ **Debug Component Optimization**: Removed React Router dependencies from GameContextDebugger for improved compatibility

### Developer Debug Tools (Latest) ‚úÖ FULLY OPERATIONAL
- ‚úÖ **GameContextDebugger Component**: Visual debugging overlay integrated into main App component for real-time context monitoring
- ‚úÖ **useGameContextDebug Hook**: Enhanced debugging version of useGameContext with comprehensive logging and error tracking
- ‚úÖ **Debug Mode Activation**: Enable via URL parameter `?debug=context` or localStorage flag for persistent debugging
- ‚úÖ **Real-time Debug Panel**: Shows current path, game ID, direct access status, loading state, and detailed error information
- ‚úÖ **Debug Log History**: Maintains timestamped log entries for troubleshooting context detection issues
- ‚úÖ **Interactive Debug Controls**: Toggle context queries and debug mode directly from the UI
- ‚úÖ **Enhanced Context API Debugging**: Comprehensive server-side logging of Devvit context properties, postData structure, and access patterns
- ‚úÖ **Multi-Level Context Detection**: API attempts multiple strategies to extract gameId from postData, context.postId, and fallback methods
- ‚úÖ **Detailed Debug Information**: API responses include debugInfo object with context keys, postData structure, and comprehensive error details
- ‚úÖ **Robust Error Handling**: Context API gracefully handles access errors with detailed logging and safe fallback responses
- ‚úÖ **TypeScript Integration**: Proper typing for debug information with queryKey string array compatibility
- ‚úÖ **Router Independence**: Debug component works without React Router dependencies for maximum compatibility
- ‚úÖ **App Integration**: GameContextDebugger properly integrated as wrapper component in main App
- ‚úÖ **Visual Debugging Overlay**: Non-intrusive debug panel that can be toggled on/off as needed

### Direct Game Entry System (Latest) ‚úÖ FULLY IMPLEMENTED & OPERATIONAL
- ‚úÖ **Context Detection API**: `/api/context` endpoint detects game context from Devvit post data - ACTIVE
- ‚úÖ **Server Integration**: Context router integrated into main server with comprehensive error handling - ACTIVE
- ‚úÖ **Post Data Access**: Leverages `context.postData` from Devvit server context for game identification - ACTIVE
- ‚úÖ **Client-Side Context Hook**: `useGameContext` hook with React Query integration and 5-minute caching - ACTIVE
- ‚úÖ **GameContextLayout Component**: Intelligent routing component integrated at router root level - ACTIVE
- ‚úÖ **Automatic Game Routing**: Routes active games ‚Üí guessing interface, ended games ‚Üí results view - ACTIVE
- ‚úÖ **Smart State Detection**: Automatically detects game phase and routes to appropriate view - ACTIVE
- ‚úÖ **Graceful Fallback**: Falls back to normal home screen behavior when context detection fails - ACTIVE
- ‚úÖ **Performance Optimized**: Single API call with intelligent caching and retry logic - ACTIVE
- ‚úÖ **React Hook Optimization**: Optimized useEffect dependencies for proper state management - ACTIVE
- ‚úÖ **Router Integration**: GameContextLayout properly integrated at root level for seamless context detection - ACTIVE
- ‚úÖ **Debug Tools**: GameContextDebugger component with real-time monitoring and interactive controls - ACTIVE

### Dynamic Content System (Latest)
- ‚úÖ **Embedded Content Management**: 150 curated spectra embedded directly in application code
- ‚úÖ **12 Content Categories**: Movies, Food, Gaming, Technology, Social Media, Life Skills, Relationships, Lifestyle, Entertainment, Internet Culture
- ‚úÖ **Context Selection UI**: Visual cards for choosing content categories with live counts
- ‚úÖ **Difficulty Filtering**: Easy (65), Medium (52), Hard (30) options with availability counts
- ‚úÖ **Enhanced Host Flow**: Step-by-step content selection with breadcrumb navigation
- ‚úÖ **Smart Caching**: Redis-based indexing for instant content filtering
- ‚úÖ **Robust Server Initialization**: Proactive content loading with validation and statistics
- ‚úÖ **Multi-Tier Fallbacks**: Embedded CSV ‚Üí Google Sheets ‚Üí Hardcoded for maximum reliability
- ‚úÖ **Serverless Optimization**: No file system dependencies, optimized for Devvit runtime
- ‚úÖ **Error Boundary Protection**: ContextSelectionErrorBoundary component prevents content loading failures from breaking the host experience

### Server Infrastructure Enhancements ‚ú® ENHANCED
- ‚úÖ **Bootstrap Server Process**: Comprehensive server initialization with content validation
- ‚úÖ **Startup Content Loading**: CSV parsing and cache population during server startup
- ‚úÖ **Content Statistics Logging**: Detailed breakdown of contexts and difficulty distribution
- ‚úÖ **Graceful Error Handling**: Server starts with fallback content if initialization fails
- ‚úÖ **Optimized Validation Pipeline**: Streamlined content validation with trusted cache data
- ‚úÖ **Enhanced Legacy Game Support**: Automatic fallback handling for games with missing or invalid spectrum data
- ‚úÖ **Performance-Optimized Recovery**: Simplified validation reduces overhead while maintaining reliability or invalid spectrum data

### API Enhancements
- ‚úÖ **New Context Endpoint**: `GET /api/context` - Detects game context from Devvit post data for direct game entry
- ‚úÖ **Content Management**: `GET /api/contexts` - Returns available contexts with counts
- ‚úÖ **Enhanced Draft API**: Accepts optional context and difficulty filters
- ‚úÖ **Backward Compatibility**: Existing random selection still works
- ‚úÖ **Improved Error Handling**: Detailed logging and graceful degradation
- ‚úÖ **Enhanced API Monitoring**: Comprehensive request/response logging with performance tracking
- ‚úÖ **Debug-Friendly Logging**: Detailed context information and error traces for easier troubleshooting
- ‚úÖ **Type-Safe Reddit Post Integration**: Enhanced `redditPost` metadata structure with proper TypeScript typing for `postId`, `permalink`, and `url` fields
